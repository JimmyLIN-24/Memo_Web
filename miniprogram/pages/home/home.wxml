<!-- pages/home/home.wxml -->
<view class="app-container">
  <!-- Header -->
  <view class="app-header {{headerHidden ? 'hidden' : ''}}">
    <!-- Top Section -->
    <view class="header-top {{headerTopHidden ? 'hidden' : ''}}">
      <view class="header-left">
        <view class="user-info">
          <view class="user-avatar-small">ğŸ‘§ğŸ»</view>
          <view class="user-details">
            <text class="user-name">å°é¦™é¦™Grace</text>
            <view class="user-status">
              <text class="status-dot">â—</text>
              <text>åœ¨çº¿</text>
            </view>
          </view>
          <view class="home-btn" bindtap="goHome" title="è¿”å›ä¸»é¡µ">
            <text class="fa fa-home">ğŸ </text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- Middle Section -->
    <view class="header-middle {{headerMiddleHidden ? 'hidden' : ''}}">
      <view class="header-left">
        <view class="app-title">
          <text class="icon">ğŸ“‹</text>
          <text>ç‰©å“æ¸…å•å¤‡å¿˜å½•</text>
        </view>
      </view>
    </view>
    
    <!-- Bottom Section -->
    <view class="header-bottom">
      <view class="header-actions">
        <button class="btn btn-primary" bindtap="showAddItemModal">
          <text class="icon">â•</text>
          <text>æ·»åŠ ç‰©å“</text>
        </button>
        <button class="btn btn-coffee" bindtap="showCoffeeHub">
          <text class="icon">â˜•</text>
          <text>å’–å•¡è§’</text>
        </button>
        <!-- Christmas Tree Button Removed -->
        <button class="btn btn-game" bindtap="showGameOverlay">
          <text class="icon">ğŸ®</text>
          <text>Game</text>
        </button>
        <button class="btn btn-secondary" bindtap="showSettingsModal">
          <text class="icon">âš™ï¸</text>
        </button>
      </view>
    </view>
  </view>

  <!-- Notifications -->
  <view class="notifications-container" wx:if="{{notifications.length > 0}}">
    <block wx:for="{{notifications}}" wx:key="id">
      <view class="notification-item {{item.type}} {{item.expanded ? 'expanded' : ''}}" bindtap="toggleNotification" data-id="{{item.id}}">
        <view class="notification-main">
          <text class="notification-icon" wx:if="{{item.type === 'error'}}">âš ï¸</text>
          <text class="notification-icon" wx:elif="{{item.type === 'warning'}}">â³</text>
          <text class="notification-icon" wx:else>â„¹ï¸</text>
          <view class="notification-content">
            <text class="notification-title">{{item.title}}</text>
          </view>
          <view class="notification-close" catchtap="closeNotification" data-id="{{item.id}}">Ã—</view>
        </view>
        <view class="notification-details" wx:if="{{item.expanded}}">
          <text>{{item.message}}</text>
        </view>
      </view>
    </block>
  </view>

  <view class="main-layout">
    <!-- Sidebar -->
    <scroll-view scroll-y class="sidebar">
      <view class="sidebar-nav">
        <!-- Summary -->
        <view class="nav-section nav-summary">
          <view class="nav-btn nav-summary-btn {{currentCategory === 'all-summary' ? 'active' : ''}}" bindtap="changeCategory" data-category="all-summary">
            <view class="nav-icon-text">
                <text class="icon">ğŸ“Š</text>
                <text>å…¨éƒ¨ç‰©å“æ±‡æ€»</text>
            </view>
            <view class="summary-stats">
              <view class="summary-stat">
                <text class="summary-label">æ€»è®¡</text>
                <text class="summary-value">{{totalItems}}</text>
              </view>
              <view class="summary-stat alert">
                <text class="summary-label">éœ€å…³æ³¨</text>
                <text class="summary-value">{{alertItems}}</text>
              </view>
            </view>
          </view>
        </view>
        
        <!-- Categories -->
        <block wx:for="{{categories}}" wx:key="id">
          <view class="nav-section">
            <view class="nav-title">{{item.title}}</view>
            <block wx:for="{{item.subcategories}}" wx:key="id" wx:for-item="sub">
              <view class="nav-btn {{currentCategory === sub.id ? 'active' : ''}}" bindtap="changeCategory" data-category="{{sub.id}}">
                <text class="icon">{{sub.icon}}</text>
                <text>{{sub.name}}</text>
              </view>
            </block>
          </view>
        </block>
      </view>
    </scroll-view>

    <!-- Main Content -->
    <scroll-view scroll-y class="main-content">
      <view class="category-content">
        <view class="category-header">
          <text class="h2">{{categoryTitle}}</text>
          <view class="category-stats">
            <view class="stat-item">
              <text class="icon">ğŸ“¦</text>
              <text>æ€»è®¡ï¼š{{currentCategoryTotal}}</text>
            </view>
            <view class="stat-item alert">
              <text class="icon">âš ï¸</text>
              <text>éœ€è¦å…³æ³¨ï¼š{{currentCategoryAlert}}</text>
            </view>
          </view>
        </view>
        
        <!-- Search -->
        <view class="search-container">
          <view class="search-input-wrapper">
            <text class="search-icon">ğŸ”</text>
            <input type="text" id="searchInput" placeholder="æœç´¢ç‰©å“åç§°ã€å­˜æ”¾åœ°ç‚¹..." value="{{searchQuery}}" bindinput="onSearchInput" />
            <view class="search-clear" wx:if="{{searchQuery}}" bindtap="clearSearch">Ã—</view>
          </view>
        </view>

        <!-- Items Grid -->
        <view class="items-grid" wx:if="{{filteredItems.length > 0}}">
          <block wx:for="{{filteredItems}}" wx:key="id">
            <view class="item-card {{item.isExpiring ? 'warning' : ''}} {{item.isExpired ? 'alert' : ''}} {{item.isLowStock ? 'alert' : ''}}" bindtap="onItemClick" data-id="{{item.id}}">
              <!-- Status Badge -->
               <view class="status-badge {{item.statusBadgeClass}}" wx:if="{{item.statusBadge}}">{{item.statusBadge}}</view>

              <view class="item-header">
                <text class="item-name">{{item.name}}</text>
                <!-- Mobile Actions (always visible or toggleable) -->
                <view class="quantity-controls">
                    <view class="quantity-btn decrease" catchtap="updateQuantity" data-id="{{item.id}}" data-action="decrease">-</view>
                    <view class="quantity-btn increase" catchtap="updateQuantity" data-id="{{item.id}}" data-action="increase">+</view>
                </view>
              </view>
              
              <view class="item-details">
                <view class="item-detail">
                  <view class="detail-left">
                      <text class="icon">ğŸ”¢</text>
                      <text>æ•°é‡</text>
                  </view>
                  <text class="item-quantity">{{item.quantity}} {{item.unit}}</text>
                </view>
                <view class="item-detail" wx:if="{{item.location}}">
                   <view class="detail-left">
                      <text class="icon">ğŸ“</text>
                      <text>{{item.location}}</text>
                   </view>
                </view>
                <view class="item-detail {{item.expiryClass}}" wx:if="{{item.expiryDate}}">
                    <view class="detail-left">
                      <text class="icon">ğŸ“…</text>
                      <text>{{item.expiryDateDisplay}}</text>
                    </view>
                </view>
              </view>

              <!-- Edit/Delete Actions (shown on click/tap in mobile usually, or specific button) -->
              <view class="item-actions {{item.showActions ? 'mobile-visible' : ''}}">
                  <view class="action-btn edit" catchtap="editItem" data-id="{{item.id}}">âœï¸</view>
                  <view class="action-btn delete" catchtap="deleteItem" data-id="{{item.id}}">ğŸ—‘ï¸</view>
              </view>
            </view>
          </block>
        </view>

        <!-- Empty State -->
        <view class="empty-state" wx:else>
          <view class="empty-illustration">ğŸ“¦</view>
          <view class="h3">æš‚æ— ç‰©å“</view>
          <text>ç‚¹å‡»ä¸Šæ–¹çš„"æ·»åŠ ç‰©å“"æŒ‰é’®å¼€å§‹è®°å½•æ‚¨çš„æ¸…å•</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- Add/Edit Item Modal -->
  <view class="modal-overlay {{showItemModal ? 'active' : ''}}">
    <view class="modal-content">
      <view class="modal-header modal-header-fixed">
        <text class="h3">{{editingItemId ? 'ç¼–è¾‘ç‰©å“' : 'æ·»åŠ ç‰©å“'}}</text>
        <view class="modal-header-actions">
           <button class="btn btn-primary" bindtap="saveItem">ä¿å­˜</button>
           <view class="modal-close" bindtap="closeItemModal">Ã—</view>
        </view>
      </view>
      <scroll-view scroll-y class="modal-body">
        <view class="modal-form">
            <!-- Quick Select (Only for Add) -->
            <view class="quick-select-section" wx:if="{{!editingItemId}}">
                <view class="h4">å¿«é€Ÿé€‰æ‹©å¸¸ç”¨ç‰©å“</view>
                <view class="quick-select-grid">
                    <block wx:for="{{quickSelectItems}}" wx:key="name">
                        <view class="quick-select-item {{selectedQuickItem === item.name ? 'selected' : ''}}" bindtap="selectQuickItem" data-item="{{item}}">
                            {{item.name}}
                        </view>
                    </block>
                </view>
                <view class="quick-select-divider">
                    <text>æˆ–æ‰‹åŠ¨è¾“å…¥</text>
                </view>
            </view>

            <view class="form-group">
                <text class="label">ç‰©å“åç§°</text>
                <input class="input" placeholder="è¯·è¾“å…¥ç‰©å“åç§°" value="{{formData.name}}" bindinput="onInputChange" data-field="name" />
            </view>
            <view class="form-row">
                <view class="form-group">
                    <text class="label">æ•°é‡</text>
                    <input class="input" type="number" placeholder="0" value="{{formData.quantity}}" bindinput="onInputChange" data-field="quantity" />
                </view>
                <view class="form-group">
                    <text class="label">å•ä½</text>
                    <input class="input" placeholder="åŒ…/ä¸ª/ç“¶" value="{{formData.unit}}" bindinput="onInputChange" data-field="unit" />
                </view>
            </view>
             <view class="form-group">
                <text class="label">ä¿è´¨æœŸï¼ˆå¯é€‰ï¼‰</text>
                <picker mode="date" value="{{formData.expiryDate}}" bindchange="onDateChange">
                    <view class="picker input">
                        {{formData.expiryDate || 'é€‰æ‹©æ—¥æœŸ'}}
                    </view>
                </picker>
            </view>
             <view class="form-row">
                <view class="form-group">
                    <text class="label">åº“å­˜é¢„è­¦</text>
                    <input class="input" type="number" placeholder="é»˜è®¤0" value="{{formData.threshold}}" bindinput="onInputChange" data-field="threshold" />
                </view>
                <view class="form-group">
                    <text class="label">è¿‡æœŸæé†’(å¤©)</text>
                    <input class="input" type="number" placeholder="é»˜è®¤0" value="{{formData.warningDays}}" bindinput="onInputChange" data-field="warningDays" />
                </view>
            </view>
            <view class="form-group">
                <text class="label">å­˜æ”¾åœ°ç‚¹</text>
                <input class="input" placeholder="ä¾‹å¦‚ï¼šå†°ç®±" value="{{formData.location}}" bindinput="onInputChange" data-field="location" />
            </view>
            <view class="form-group">
                <text class="label">åˆ†ç±»</text>
                <picker mode="multiSelector" range="{{categoryRange}}" range-key="name" bindchange="onCategoryChange" bindcolumnchange="onCategoryColumnChange">
                    <view class="picker input">
                        {{categoryDisplay || 'é€‰æ‹©åˆ†ç±»'}}
                    </view>
                </picker>
            </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- Settings Modal (Placeholder) -->
  <view class="modal-overlay {{showSettingsModal ? 'active' : ''}}">
      <view class="modal-content">
          <view class="modal-header">
              <text class="h3">è®¾ç½®</text>
              <view class="modal-close" bindtap="closeSettingsModal">Ã—</view>
          </view>
          <view class="settings-content">
              <view class="setting-item">
                  <switch checked="{{settings.enableNotifications}}" bindchange="toggleNotifications" />
                  <text> å¯ç”¨æé†’é€šçŸ¥</text>
              </view>
              <view class="setting-actions">
                  <button class="btn btn-primary" bindtap="saveSettings">ä¿å­˜</button>
              </view>
          </view>
      </view>
  </view>

  <!-- Coffee Hub & Game will be added later or as separate components -->
</view>
